<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.DangdangBackMapper">
    
    <resultMap type="com.ruoyi.system.domain.DangdangBack" id="DangdangBackResult">
        <result property="id"    column="id"    />
        <result property="ddDate"    column="dd_date"    />
        <result property="channelId"    column="channel_id"    />
        <result property="uv"    column="uv"    />
        <result property="addActiveUser"    column="add_active_user"    />
        <result property="coollectingPureNewCustomers"    column="coollecting_pure_new_customers"    />
        <result property="bookingNewCustomersPureInfiltration"    column="booking_new_customers_pure_infiltration"    />
        <result property="orderingOrders"    column="ordering_orders"    />
        <result property="receivingAmount"    column="receiving_amount"    />
        <result property="pureOutOfTheLibrary"    column="pure_out_of_the_library"    />
        <result property="outboundNewCustomersPureInfiltration"    column="outbound_new_customers_pure_infiltration"    />
        <result property="outboundOrderNumber"    column="outbound_order_number"    />
        <result property="outboundAmount"    column="outbound_amount"    />
        <result property="identification"    column="identification"    />
        <result property="dis"    column="dis"    />
    </resultMap>
	
	<sql id="selectDangdangBackVo">
        select id, dd_date, channel_id, uv, add_active_user, coollecting_pure_new_customers, booking_new_customers_pure_infiltration, ordering_orders, receiving_amount, pure_out_of_the_library, outbound_new_customers_pure_infiltration, outbound_order_number, outbound_amount, identification, dis from dangdang_back
    </sql>
	
    <select id="selectDangdangBackList" parameterType="DangdangBack" resultMap="DangdangBackResult">
        <include refid="selectDangdangBackVo"/>
        <where>  
            <if test="id != null "> and id = #{id}</if>
             <if test="ddDate != null "> and dd_date = #{ddDate}</if>
             <if test="channelId != null  and channelId != '' "> and channel_id = #{channelId}</if>
             <if test="uv != null "> and uv = #{uv}</if>
             <if test="addActiveUser != null "> and add_active_user = #{addActiveUser}</if>
             <if test="coollectingPureNewCustomers != null "> and coollecting_pure_new_customers = #{coollectingPureNewCustomers}</if>
             <if test="bookingNewCustomersPureInfiltration != null "> and booking_new_customers_pure_infiltration = #{bookingNewCustomersPureInfiltration}</if>
             <if test="orderingOrders != null "> and ordering_orders = #{orderingOrders}</if>
             <if test="receivingAmount != null "> and receiving_amount = #{receivingAmount}</if>
             <if test="pureOutOfTheLibrary != null "> and pure_out_of_the_library = #{pureOutOfTheLibrary}</if>
             <if test="outboundNewCustomersPureInfiltration != null "> and outbound_new_customers_pure_infiltration = #{outboundNewCustomersPureInfiltration}</if>
             <if test="outboundOrderNumber != null "> and outbound_order_number = #{outboundOrderNumber}</if>
             <if test="outboundAmount != null "> and outbound_amount = #{outboundAmount}</if>
             <if test="identification != null  and identification != '' "> and identification = #{identification}</if>
             <if test="dis != null  and dis != '' "> and dis = #{dis}</if>
         </where>
    </select>
    
    <select id="selectDangdangBackById" parameterType="Integer" resultMap="DangdangBackResult">
        <include refid="selectDangdangBackVo"/>
        where id = #{id}
    </select>
        
    <insert id="insertDangdangBack" parameterType="DangdangBack" useGeneratedKeys="true" keyProperty="id">
        insert into dangdang_back
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="ddDate != null  ">dd_date,</if>
			<if test="channelId != null  and channelId != ''  ">channel_id,</if>
			<if test="uv != null  ">uv,</if>
			<if test="addActiveUser != null  ">add_active_user,</if>
			<if test="coollectingPureNewCustomers != null  ">coollecting_pure_new_customers,</if>
			<if test="bookingNewCustomersPureInfiltration != null  ">booking_new_customers_pure_infiltration,</if>
			<if test="orderingOrders != null  ">ordering_orders,</if>
			<if test="receivingAmount != null  ">receiving_amount,</if>
			<if test="pureOutOfTheLibrary != null  ">pure_out_of_the_library,</if>
			<if test="outboundNewCustomersPureInfiltration != null  ">outbound_new_customers_pure_infiltration,</if>
			<if test="outboundOrderNumber != null  ">outbound_order_number,</if>
			<if test="outboundAmount != null  ">outbound_amount,</if>
			<if test="identification != null  and identification != ''  ">identification,</if>
			<if test="dis != null  and dis != ''  ">dis,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="ddDate != null  ">#{ddDate},</if>
			<if test="channelId != null  and channelId != ''  ">#{channelId},</if>
			<if test="uv != null  ">#{uv},</if>
			<if test="addActiveUser != null  ">#{addActiveUser},</if>
			<if test="coollectingPureNewCustomers != null  ">#{coollectingPureNewCustomers},</if>
			<if test="bookingNewCustomersPureInfiltration != null  ">#{bookingNewCustomersPureInfiltration},</if>
			<if test="orderingOrders != null  ">#{orderingOrders},</if>
			<if test="receivingAmount != null  ">#{receivingAmount},</if>
			<if test="pureOutOfTheLibrary != null  ">#{pureOutOfTheLibrary},</if>
			<if test="outboundNewCustomersPureInfiltration != null  ">#{outboundNewCustomersPureInfiltration},</if>
			<if test="outboundOrderNumber != null  ">#{outboundOrderNumber},</if>
			<if test="outboundAmount != null  ">#{outboundAmount},</if>
			<if test="identification != null  and identification != ''  ">#{identification},</if>
			<if test="dis != null  and dis != ''  ">#{dis},</if>
         </trim>
    </insert>
    <update id="updateGroupword" parameterType="String">
       update dangdang_back set Identification = #{str} where Identification is null
    </update>
    <update id="updateBaiduIdentification">
         update dangdang_back set dis='5201' where channel_id like '%5201' and Identification = '百度'
    </update>
    <insert id="batchInsert"  parameterType="java.util.List" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO dangdang_back (dd_date,channel_id,uv,add_active_user,coollecting_pure_new_customers,booking_new_customers_pure_infiltration,
        ordering_orders,receiving_amount,pure_out_of_the_library,outbound_new_customers_pure_infiltration,outbound_order_number,outbound_amount)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.ddDate}, #{item.channelId},#{item.uv},#{item.addActiveUser},#{item.coollectingPureNewCustomers},
            #{item.bookingNewCustomersPureInfiltration},#{item.orderingOrders},#{item.receivingAmount},
            #{item.pureOutOfTheLibrary},#{item.outboundNewCustomersPureInfiltration},#{item.outboundOrderNumber},#{item.outboundAmount})
        </foreach>
    </insert>

    <update id="updateDangdangBack" parameterType="DangdangBack">
        update dangdang_back
        <trim prefix="SET" suffixOverrides=",">
            <if test="ddDate != null  ">dd_date = #{ddDate},</if>
            <if test="channelId != null  and channelId != ''  ">channel_id = #{channelId},</if>
            <if test="uv != null  ">uv = #{uv},</if>
            <if test="addActiveUser != null  ">add_active_user = #{addActiveUser},</if>
            <if test="coollectingPureNewCustomers != null  ">coollecting_pure_new_customers = #{coollectingPureNewCustomers},</if>
            <if test="bookingNewCustomersPureInfiltration != null  ">booking_new_customers_pure_infiltration = #{bookingNewCustomersPureInfiltration},</if>
            <if test="orderingOrders != null  ">ordering_orders = #{orderingOrders},</if>
            <if test="receivingAmount != null  ">receiving_amount = #{receivingAmount},</if>
            <if test="pureOutOfTheLibrary != null  ">pure_out_of_the_library = #{pureOutOfTheLibrary},</if>
            <if test="outboundNewCustomersPureInfiltration != null  ">outbound_new_customers_pure_infiltration = #{outboundNewCustomersPureInfiltration},</if>
            <if test="outboundOrderNumber != null  ">outbound_order_number = #{outboundOrderNumber},</if>
            <if test="outboundAmount != null  ">outbound_amount = #{outboundAmount},</if>
            <if test="identification != null  and identification != ''  ">identification = #{identification},</if>
            <if test="dis != null  and dis != ''  ">dis = #{dis},</if>
        </trim>
        where id = #{id}
    </update>
    <update id="updateJoin">

    </update>

    <delete id="deleteDangdangBackById" parameterType="Integer">
        delete from dangdang_back where id = #{id}
    </delete>
	
    <delete id="deleteDangdangBackByIds" parameterType="String">
        delete from dangdang_back where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <select id="queryUrl" resultType="com.ruoyi.system.domain.DangdangBack" parameterType="com.ruoyi.system.domain.DangdangBack">
        SELECT
        ht.uv,
        ht.add_active_user ,
        ht.coollecting_pure_new_customers  ,
        ht.booking_new_customers_pure_infiltration,
        ht.ordering_orders,
        ht.receiving_amount,
        ht.pureoutofthelibrary as pureOutOfTheLibrary ,
        ht.outbound_new_customers_pure_infiltration,
        ht.outbound_order_number,
        ht.outbound_amount
        FROM
        (
        SELECT
        f.combination AS fCombination,
        f.dd_date AS fDate,
        f.account AS fAccount,
        f.plan AS fPlan,
        f.unit AS fUnit,
        f.keyword AS fKeyword,
        f.showdata AS fShowDate,
        f.click AS fClick,
        f.cost AS fCost,
        f.app_showData AS fAppShowData,
        f.app_click AS fAppClick,
        f.app_cost AS fAppCost,
        f.lets_showdata AS fLetsShowData,
        f.lets_click AS fLetsClick,
        f.lets_cost AS fLetsCost,
        m.mobile_access_url,
        m.applet_url,
        m.applet_done
        FROM
        (
        SELECT
        s.combination,
        s.account,
        s.dd_date,
        s.plan,
        s.unit,
        s.keyword,
        s.showdata,
        s.click,
        s.cost,
        s.click_rate,
        s.average_click_price,
        s.bid,
        s.homepage_average_ranking,
        s.part_speech,
        w.click AS app_click,
        w.cost AS app_cost,
        w.showdata AS app_showData,
        q.click AS lets_click,
        q.cost AS lets_cost,
        q.showdata AS lets_showData
        FROM
        dangdang_summary AS s
        LEFT JOIN (
        SELECT
        date,
        combination,
        sum( click ) AS click,
        sum( showdata ) AS showdata,
        SUM( cost ) AS cost
        FROM
        dangdang_app_front
        WHERE
        app = '当当网'
        GROUP BY
        date,
        combination
        ) AS w ON s.dd_date = w.date
        AND s.combination = w.combination
        LEFT JOIN (
        SELECT
        date,
        combination,
        sum( click ) AS click,
        sum( showdata ) AS showdata,
        SUM( cost ) AS cost
        FROM
        dangdang_applets_front
        GROUP BY
        date,
        combination
        ) AS q ON s.dd_date = q.date
        AND s.combination = q.combination
        ) AS f
        LEFT JOIN dangdang_match AS m ON f.combination = m.combination
        ) AS fh
        LEFT JOIN
        (SELECT
        dd_date,
        channel_id,
        sum( uv ) AS uv,
        sum( add_active_user ) AS add_active_user,
        sum( coollecting_pure_new_customers ) AS coollecting_pure_new_customers,
        sum( booking_new_customers_pure_infiltration ) AS booking_new_customers_pure_infiltration,
        sum( ordering_orders ) AS ordering_orders,
        sum( receiving_amount ) AS receiving_amount,
        sum( pure_out_of_the_library ) AS pureoutofthelibrary,
        sum( outbound_new_customers_pure_infiltration ) AS outbound_new_customers_pure_infiltration,
        sum( outbound_order_number ) AS outbound_order_number,
        sum( outbound_amount ) AS outbound_amount
        FROM
        dangdang_back
        GROUP BY
        dd_date,
        channel_id
        ) as ht ON ht.channel_id = fh.applet_url AND ht.dd_date = fh.fDate
        where 1=1 <if test="ddDate != null  "> and fh.fDate= #{ddDate}</if> ORDER BY fh.fDate desc
    </select>
    <select id="queryMod" resultType="com.ruoyi.system.domain.DangdangBack"  parameterType="com.ruoyi.system.domain.DangdangSearchAdd">
        SELECT
        ht.uv ,
        ht.add_active_user as  addActiveUser ,
        ht.coollecting_pure_new_customers   as coollectingPureNewCustomers,
        ht.booking_new_customers_pure_infiltration as bookingNewCustomersPureInfiltration ,
        ht.ordering_orders as orderingOrders  ,
        ht.receiving_amount as receivingAmount ,
        ht.pure_out_of_the_library as pureOutOfTheLibrary  ,
        ht.outbound_new_customers_pure_infiltration  as outboundNewCustomersPureInfiltration ,
        ht.outbound_order_number  as outboundOrderNumber  ,
        ht.outbound_amount as outboundAmount
        FROM
        (
        SELECT
        f.combination AS fCombination,
        f.dd_date AS fDate,
        f.account AS fAccount,
        f.plan AS fPlan,
        f.unit AS fUnit,
        f.keyword AS fKeyword,
        f.showdata AS fShowDate,
        f.click AS fClick,
        f.cost AS fCost,
        f.app_showData AS fAppShowData,
        f.app_click AS fAppClick,
        f.app_cost AS fAppCost,
        f.lets_showdata AS fLetsShowData,
        f.lets_click AS fLetsClick,
        f.lets_cost AS fLetsCost,
        m.mobile_access_url,
        m.applet_url,
        m.applet_done
        FROM
        (
        SELECT
        s.combination,
        s.account,
        s.dd_date,
        s.plan,
        s.unit,
        s.keyword,
        s.showdata,
        s.click,
        s.cost,
        s.click_rate,
        s.average_click_price,
        s.bid,
        s.homepage_average_ranking,
        s.part_speech,
        w.click AS app_click,
        w.cost AS app_cost,
        w.showdata AS app_showData,
        q.click AS lets_click,
        q.cost AS lets_cost,
        q.showdata AS lets_showData
        FROM
        dangdang_summary AS s
        LEFT JOIN (
        SELECT
        date,
        combination,
        sum( click ) AS click,
        sum( showdata ) AS showdata,
        SUM( cost ) AS cost
        FROM
        dangdang_app_front
        WHERE
        app = '当当网'
        GROUP BY
        date,
        combination
        ) AS w ON s.dd_date = w.date
        AND s.combination = w.combination
        LEFT JOIN (
        SELECT
        date,
        combination,
        sum( click ) AS click,
        sum( showdata ) AS showdata,
        SUM( cost ) AS cost
        FROM
        dangdang_applets_front
        GROUP BY
        date,
        combination
        ) AS q ON s.dd_date = q.date
        AND s.combination = q.combination
        ) AS f
        LEFT JOIN dangdang_match AS m ON f.combination = m.combination
        ) AS fh
        LEFT JOIN (
        SELECT
        dd_date,
        channel_id,
        sum(uv) AS uv,
        sum(add_active_user) AS add_active_user,
        sum(coollecting_pure_new_customers) AS coollecting_pure_new_customers,
        sum(booking_new_customers_pure_infiltration) AS booking_new_customers_pure_infiltration,
        sum(ordering_orders) AS ordering_orders,
        sum(receiving_amount) AS receiving_amount,
        sum(pure_out_of_the_library) AS pure_out_of_the_library,
        sum(outbound_new_customers_pure_infiltration ) AS outbound_new_customers_pure_infiltration,
        sum(outbound_order_number) AS outbound_order_number,
        sum(outbound_amount) AS outbound_amount
        FROM
        dangdang_back
        GROUP BY
        dd_date,
        channel_id
        ) ht ON ht.channel_id = fh.mobile_access_url
        AND ht.dd_date = fh.fDate
        where 1=1 <if test="ddDate != null  "> and fh.fDate= #{ddDate}</if>
        ORDER BY fh.fDate desc
    </select>
</mapper>