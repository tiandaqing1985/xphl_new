<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.XzAsstesMapper">

	<resultMap type="XzAsstes" id="XzAsstesResult">
		<result property="id" column="id" />
		<result property="assetsId" column="assets_id" />
		<result property="region" column="region" />
		<result property="assetsName" column="assets_name" />
		<result property="assetsType" column="assets_type" />
		<result property="assetsType2" column="assets_type2" />
		<result property="assetsModel" column="assets_model" />
		<result property="price" column="price" />
		<result property="unit" column="unit" />
		<result property="count" column="count" />
		<result property="attach" column="attach" />
		<result property="purchaseNum" column="purchase_num" />
		<result property="category" column="category" />
		<result property="brand" column="brand" />
		<result property="buyAddress" column="buy_address" />
		<result property="manufacturer" column="manufacturer" />
		<result property="supplier" column="supplier" />
		<result property="invoiceType" column="invoice_type" />
		<result property="invoiceNum" column="invoice_num" />
		<result property="purchaseBy" column="purchase_by" />
		<result property="buyDate" column="buy_date" />
		<result property="annex" column="annex" />
		<result property="remarks" column="remarks" />
		<result property="extendMoney" column="extend_money" />
		<result property="extendTime" column="extend_time" />
		<result property="extendContent" column="extend_content" />
		<result property="assetsStatus" column="assets_status" />
		<result property="useStatus" column="use_status" />
		<result property="useBy" column="use_by" />
		<result property="department" column="department" />
		<result property="useTime" column="use_time" />
		<result property="submitType" column="submit_type" />
		<result property="scrapDate" column="scrap_date" />
		<result property="storeWay" column="store_way" />
		<result property="createBy" column="create_by" />
		<result property="createTime" column="create_time" />
		<result property="updateBy" column="update_by" />
		<result property="updateTime" column="update_time" />
		<result property="subBy" column="sub_by" />
		<result property="subTime" column="sub_time" />
		<result property="sort" column="sort" />
		<result property="useName" column="use_name" />
		<result property="departmentName" column="department_name" />
		<result property="purchaseName" column="purchase_name" />
	</resultMap>

	<sql id="selectXzAsstesVo">
		select id, assets_id, region, assets_name, assets_type, assets_type2,
		assets_model, price, unit, count, attach, purchase_num, category,
		brand, buy_address, manufacturer, supplier, invoice_type, invoice_num,
		purchase_by, buy_date, annex, remarks, extend_money, extend_time,
		extend_content, assets_status, use_status, use_by, department,
		use_time, submit_type, scrap_date, store_way, create_by, create_time,
		update_by, update_time, sub_by, sub_time ,sort from xz_asstes
	</sql>

	<sql id="selectXzAsstes">
		select a.id, a.assets_id, a.region, a.assets_name, a.assets_type,
		a.assets_type2, a.assets_model, a.price, a.unit, a.count, a.attach,
		a.purchase_num, a.category, a.brand, a.buy_address,
		a.manufacturer, a.supplier, a.invoice_type, a.invoice_num, a.purchase_by, a.buy_date,
		a.annex, a.remarks, a.extend_money, a.extend_time, a.extend_content,
		a.assets_status,
		a.use_status, a.use_by, a.department, a.use_time, a.submit_type, a.scrap_date,
		a.store_way, a.create_by, a.create_time, a.update_by, a.update_time,
		a.sub_by, a.sub_time, a.sort,su.user_name purchase_name,user.user_name
		use_name,d.dept_name department_name from xz_asstes a
		left join sys_user su on su.user_id =a.purchase_by
		left join sys_user user on user.user_id =a.use_by
		left join sys_dept d on d.dept_id = a.department
	</sql>

	<select id="selectXzAsstesList" parameterType="XzAsstes"
		resultMap="XzAsstesResult">
		<include refid="selectXzAsstes" />
		<where>
			<if test="id != null "> and id = #{id}</if>
			<if test="sort != null and sort !='' "> and a.sort =#{sort}</if>
			<if test="assetsId != null  and assetsId != '' "> and assets_id = #{assetsId}</if>
			<if test="region != null  and region != '' "> and region = #{region}</if>
			<if test="assetsName != null  and assetsName != '' "> and assets_name = #{assetsName}</if>
			<if test="assetsType != null  and assetsType != '' "> and assets_type = #{assetsType}</if>
			<if test="assetsType2 != null  and assetsType2 != '' "> and assets_type2 = #{assetsType2}</if>
			<if test="assetsModel != null  and assetsModel != '' "> and assets_model = #{assetsModel}</if>
			<if test="price != null  and price != '' "> and price = #{price}</if>
			<if test="unit != null  and unit != '' "> and unit = #{unit}</if>
			<if test="count != null  and count != '' "> and count = #{count}</if>
			<if test="attach != null  and attach != '' "> and attach = #{attach}</if>
			<if test="purchaseNum != null  and purchaseNum != '' "> and purchase_num = #{purchaseNum}</if>
			<if test="category != null  and category != '' "> and category = #{category}</if>
			<if test="brand != null  and brand != '' "> and brand = #{brand}</if>
			<if test="buyAddress != null  and buyAddress != '' "> and buy_address = #{buyAddress}</if>
			<if test="manufacturer != null  and manufacturer != '' "> and manufacturer = #{manufacturer}</if>
			<if test="supplier != null  and supplier != '' "> and supplier = #{supplier}</if>
			<if test="invoiceType != null  and invoiceType != '' "> and invoice_type = #{invoiceType}</if>
			<if test="invoiceNum != null  and invoiceNum != '' "> and invoice_num = #{invoiceNum}</if>
			<if test="purchaseBy != null  and purchaseBy != '' "> and purchase_by = #{purchaseBy}</if>
			<!-- <if test="buyDate != null "> and buy_date = #{buyDate}</if> -->
			<if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
				AND date_format(buy_date,'%y%m%d') &gt;=
				date_format(#{params.beginTime},'%y%m%d')
			</if>
			<if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
				AND date_format(buy_date,'%y%m%d') &lt;=
				date_format(#{params.endTime},'%y%m%d')
			</if>
			<if test="annex != null  and annex != '' "> and annex = #{annex}</if>
			<if test="remarks != null  and remarks != '' "> and remarks = #{remarks}</if>
			<if test="extendMoney != null  and extendMoney != '' "> and extend_money = #{extendMoney}</if>
			<if test="extendTime != null "> and extend_time = #{extendTime}</if>
			<if test="extendContent != null  and extendContent != '' "> and extend_content = #{extendContent}</if>
			<if test="assetsStatus != null  and assetsStatus != '' "> and assets_status = #{assetsStatus}</if>
			<if test="useStatus != null  and useStatus != '' "> and use_status = #{useStatus}</if>
			<if test="useBy != null  and useBy != '' "> and use_by = #{useBy}</if>
			<if test="department != null  and department != '' "> and department = #{department}</if>
			<if test="useTime != null "> and use_time = #{useTime}</if>
			<if test="submitType != null  and submitType != '' "> and submit_type = #{submitType}</if>
			<if test="scrapDate != null "> and scrap_date = #{scrapDate}</if>
			<if test="storeWay != null  and storeWay != '' "> and store_way = #{storeWay}</if>
			<if test="createBy != null  and createBy != '' "> and create_by = #{createBy}</if>
			<if test="createTime != null "> and create_time = #{createTime}</if>
			<if test="updateBy != null  and updateBy != '' "> and update_by = #{updateBy}</if>
			<if test="updateTime != null "> and update_time = #{updateTime}</if>
			<if test="subBy != null  and subBy != '' "> and sub_by = #{subBy}</if>
			<if test="subTime != null "> and sub_time = #{subTime}</if>
		</where>
		ORDER BY create_time DESC
		<!-- 数据范围过滤 -->
		${params.dataScope}
	</select>

	<select id="selectXzAsstesById" parameterType="Long" resultMap="XzAsstesResult">
		<include refid="selectXzAsstesVo" />
		where id = #{id}
	</select>

	<insert id="insertXzAsstes" parameterType="XzAsstes">
		insert into xz_asstes
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null  ">id,</if>
			<if test="assetsId != null  and assetsId != ''  ">assets_id,</if>
			<if test="region != null  and region != ''  ">region,</if>
			<if test="assetsName != null  and assetsName != ''  ">assets_name,</if>
			<if test="assetsType != null  and assetsType != ''  ">assets_type,</if>
			<if test="assetsType2 != null  and assetsType2 != ''  ">assets_type2,</if>
			<if test="assetsModel != null  and assetsModel != ''  ">assets_model,</if>
			<if test="price != null  and price != ''  ">price,</if>
			<if test="unit != null  and unit != ''  ">unit,</if>
			<if test="count != null  and count != ''  ">count,</if>
			<if test="attach != null  and attach != ''  ">attach,</if>
			<if test="purchaseNum != null  and purchaseNum != ''  ">purchase_num,</if>
			<if test="category != null  and category != ''  ">category,</if>
			<if test="brand != null  and brand != ''  ">brand,</if>
			<if test="buyAddress != null  and buyAddress != ''  ">buy_address,</if>
			<if test="manufacturer != null  and manufacturer != ''  ">manufacturer,</if>
			<if test="supplier != null  and supplier != ''  ">supplier,</if>
			<if test="invoiceType != null  and invoiceType != ''  ">invoice_type,</if>
			<if test="invoiceNum != null  and invoiceNum != ''  ">invoice_num,</if>
			<if test="purchaseBy != null  and purchaseBy != ''  ">purchase_by,</if>
			<if test="buyDate != null  ">buy_date,</if>
			<if test="annex != null  and annex != ''  ">annex,</if>
			<if test="remarks != null  and remarks != ''  ">remarks,</if>
			<if test="extendMoney != null  and extendMoney != ''  ">extend_money,</if>
			<if test="extendTime != null  ">extend_time,</if>
			<if test="extendContent != null  and extendContent != ''  ">extend_content,</if>
			<if test="assetsStatus != null  and assetsStatus != ''  ">assets_status,</if>
			<if test="useStatus != null  and useStatus != ''  ">use_status,</if>
			<if test="useBy != null  and useBy != ''  ">use_by,</if>
			<if test="department != null  and department != ''  ">department,</if>
			<if test="useTime != null  ">use_time,</if>
			<if test="submitType != null  and submitType != ''  ">submit_type,</if>
			<if test="scrapDate != null  ">scrap_date,</if>
			<if test="storeWay != null  and storeWay != ''  ">store_way,</if>
			<if test="createBy != null  and createBy != ''  ">create_by,</if>
			<if test="createTime != null  ">create_time,</if>
			<if test="updateBy != null  and updateBy != ''  ">update_by,</if>
			<if test="updateTime != null  ">update_time,</if>
			<if test="subBy != null  and subBy != ''  ">sub_by,</if>
			<if test="subTime != null  ">sub_time,</if>
			<if test="sort != null and sort !='' ">sort,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null  ">#{id},</if>
			<if test="assetsId != null  and assetsId != ''  ">#{assetsId},</if>
			<if test="region != null  and region != ''  ">#{region},</if>
			<if test="assetsName != null  and assetsName != ''  ">#{assetsName},</if>
			<if test="assetsType != null  and assetsType != ''  ">#{assetsType},</if>
			<if test="assetsType2 != null  and assetsType2 != ''  ">#{assetsType2},</if>
			<if test="assetsModel != null  and assetsModel != ''  ">#{assetsModel},</if>
			<if test="price != null  and price != ''  ">#{price},</if>
			<if test="unit != null  and unit != ''  ">#{unit},</if>
			<if test="count != null  and count != ''  ">#{count},</if>
			<if test="attach != null  and attach != ''  ">#{attach},</if>
			<if test="purchaseNum != null  and purchaseNum != ''  ">#{purchaseNum},</if>
			<if test="category != null  and category != ''  ">#{category},</if>
			<if test="brand != null  and brand != ''  ">#{brand},</if>
			<if test="buyAddress != null  and buyAddress != ''  ">#{buyAddress},</if>
			<if test="manufacturer != null  and manufacturer != ''  ">#{manufacturer},</if>
			<if test="supplier != null  and supplier != ''  ">#{supplier},</if>
			<if test="invoiceType != null  and invoiceType != ''  ">#{invoiceType},</if>
			<if test="invoiceNum != null  and invoiceNum != ''  ">#{invoiceNum},</if>
			<if test="purchaseBy != null  and purchaseBy != ''  ">#{purchaseBy},</if>
			<if test="buyDate != null  ">#{buyDate},</if>
			<if test="annex != null  and annex != ''  ">#{annex},</if>
			<if test="remarks != null  and remarks != ''  ">#{remarks},</if>
			<if test="extendMoney != null  and extendMoney != ''  ">#{extendMoney},</if>
			<if test="extendTime != null  ">#{extendTime},</if>
			<if test="extendContent != null  and extendContent != ''  ">#{extendContent},</if>
			<if test="assetsStatus != null  and assetsStatus != ''  ">#{assetsStatus},</if>
			<if test="useStatus != null  and useStatus != ''  ">#{useStatus},</if>
			<if test="useBy != null  and useBy != ''  ">#{useBy},</if>
			<if test="department != null  and department != ''  ">#{department},</if>
			<if test="useTime != null  ">#{useTime},</if>
			<if test="submitType != null  and submitType != ''  ">#{submitType},</if>
			<if test="scrapDate != null  ">#{scrapDate},</if>
			<if test="storeWay != null  and storeWay != ''  ">#{storeWay},</if>
			<if test="createBy != null  and createBy != ''  ">#{createBy},</if>
			<if test="createTime != null  ">#{createTime},</if>
			<if test="updateBy != null  and updateBy != ''  ">#{updateBy},</if>
			<if test="updateTime != null  ">#{updateTime},</if>
			<if test="subBy != null  and subBy != ''  ">#{subBy},</if>
			<if test="subTime != null  ">#{subTime},</if>
			<if test="sort != null and sort !='' ">#{sort},</if>
		</trim>
	</insert>

	<update id="updateXzAsstes" parameterType="XzAsstes">
		update xz_asstes
		<trim prefix="SET" suffixOverrides=",">
			<if test="assetsId != null  and assetsId != ''  ">assets_id = #{assetsId},</if>
			<if test="region != null  and region != ''  ">region = #{region},</if>
			<if test="assetsName != null  and assetsName != ''  ">assets_name = #{assetsName},</if>
			<if test="assetsType != null  and assetsType != ''  ">assets_type = #{assetsType},</if>
			<if test="assetsType2 != null  and assetsType2 != ''  ">assets_type2 = #{assetsType2},</if>
			<if test="assetsModel != null  and assetsModel != ''  ">assets_model = #{assetsModel},</if>
			<if test="price != null  and price != ''  ">price = #{price},</if>
			<if test="unit != null  and unit != ''  ">unit = #{unit},</if>
			<if test="count != null  and count != ''  ">count = #{count},</if>
			<if test="attach != null  and attach != ''  ">attach = #{attach},</if>
			<if test="purchaseNum != null  and purchaseNum != ''  ">purchase_num = #{purchaseNum},</if>
			<if test="category != null  and category != ''  ">category = #{category},</if>
			<if test="brand != null  and brand != ''  ">brand = #{brand},</if>
			<if test="buyAddress != null  and buyAddress != ''  ">buy_address = #{buyAddress},</if>
			<if test="manufacturer != null  and manufacturer != ''  ">manufacturer = #{manufacturer},</if>
			<if test="supplier != null  and supplier != ''  ">supplier = #{supplier},</if>
			<if test="invoiceType != null  and invoiceType != ''  ">invoice_type = #{invoiceType},</if>
			<if test="invoiceNum != null  and invoiceNum != ''  ">invoice_num = #{invoiceNum},</if>
			<if test="purchaseBy != null  and purchaseBy != ''  ">purchase_by = #{purchaseBy},</if>
			<if test="buyDate != null  ">buy_date = #{buyDate},</if>
			<if test="annex != null  and annex != ''  ">annex = #{annex},</if>
			<if test="remarks != null  and remarks != ''  ">remarks = #{remarks},</if>
			<if test="extendMoney != null  and extendMoney != ''  ">extend_money = #{extendMoney},</if>
			<if test="extendTime != null  ">extend_time = #{extendTime},</if>
			<if test="extendContent != null  and extendContent != ''  ">extend_content = #{extendContent},</if>
			<if test="assetsStatus != null  and assetsStatus != ''  ">assets_status = #{assetsStatus},</if>
			<if test="useStatus != null  and useStatus != ''  ">use_status = #{useStatus},</if>
			<if test="useBy != null  and useBy != ''  ">use_by = #{useBy},</if>
			<if test="department != null  and department != ''  ">department = #{department},</if>
			<if test="useTime != null  ">use_time = #{useTime},</if>
			<if test="submitType != null  and submitType != ''  ">submit_type = #{submitType},</if>
			<if test="scrapDate != null  ">scrap_date = #{scrapDate},</if>
			<if test="storeWay != null  and storeWay != ''  ">store_way = #{storeWay},</if>
			<if test="createBy != null  and createBy != ''  ">create_by = #{createBy},</if>
			<if test="createTime != null  ">create_time = #{createTime},</if>
			<if test="updateBy != null  and updateBy != ''  ">update_by = #{updateBy},</if>
			<if test="updateTime != null  ">update_time = #{updateTime},</if>
			<if test="subBy != null  and subBy != ''  ">sub_by = #{subBy},</if>
			<if test="subTime != null  ">sub_time = #{subTime},</if>
		</trim>
		where id = #{id}
	</update>

	<delete id="deleteXzAsstesById" parameterType="Long">
		delete from xz_asstes where id = #{id}
	</delete>

	<delete id="deleteXzAsstesByIds" parameterType="String">
		delete from xz_asstes where id in
		<foreach item="id" collection="array" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</delete>

	<!-- 批量插入数据 -->
	<insert id="batchInsert" parameterType="java.util.List"
		useGeneratedKeys="true" keyProperty="id">
		INSERT INTO xz_asstes
		(assets_id,region,assets_name,assets_type,assets_model,price,unit,count,attach,purchase_num,category,brand,buy_address,
		purchase_by,buy_date,extend_money,extend_time,extend_content,assets_status,use_status,use_by,department,use_time)
		VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.assetsId},#{item.region},#{item.assetsName},#{item.assetsType},#{item.assetsModel},#{item.price},#{item.unit},#{item.count},
			#{item.attach},#{item.purchaseNum},#{item.category},#{item.brand},#{item.buyAddress},#{item.purchaseBy},#{item.buyDate},#{item.extendMoney},
			#{item.extendTime},#{item.extendContent},#{item.assetsStatus},#{item.useStatus},#{item.useBy},#{item.department},#{item.useTime})
		</foreach>
	</insert>

	<!-- 固定资产 -->
	<update id="updateXzAsstesByAssDraw" parameterType="XzAsstes">
		update xz_asstes
		<trim prefix="SET" suffixOverrides=",">
			use_status='3',
			<if test="useTime != null  ">use_time = #{useTime},</if>
		</trim>
		where use_by=#{useBy} and use_status='2' and sort='1'
	</update>
	<!-- 办公用品资产 -->
	<update id="updateXzAsstesByStaDraw" parameterType="XzAsstes">
		update xz_asstes
		<trim prefix="SET" suffixOverrides=",">
			use_status='5',
			<if test="useTime != null  ">use_time = #{useTime},</if>
		</trim>
		where use_by=#{useBy} and use_status='2' and sort='2'
	</update>

	<update id="updateXzAsstesByAssId" parameterType="XzAsstes">
		update xz_asstes
		<trim prefix="SET" suffixOverrides=",">
			use_status = '3',
			use_time = #{useTime},
		</trim>
		where id=#{id} and sort='1'
	</update>

	<update id="updateXzAsstesByStaId" parameterType="XzAsstes">
		update xz_asstes
		<trim prefix="SET" suffixOverrides=",">
			use_status = '5',
			use_time = #{useTime},
		</trim>
		where id=#{id} and sort='2'
	</update>

	<select id="countXzAsstesByAllDraw" parameterType="Long"
		resultType="int">
		SELECT COUNT(0) FROM xz_asstes WHERE use_by=#{useBy} and use_status='2'
	</select>

	<select id="selectMinAssetByType2AndRegion" parameterType="XzAsstes"
		resultMap="XzAsstesResult">
		<include refid="selectXzAsstes" />
		where id in (
			select min(a.id) as id
				from (select * from xz_asstes
			where 
			<if test="assetsType2 != null  and assetsType2 != '' ">assets_type2 = #{assetsType2}</if>
			<if test="region != null  and region != '' "> and region = #{region}</if>
			<if test="assetsStatus != null  and assetsStatus != '' ">  and assets_status='2'</if>
		    <if test="useStatus !=null and useStatus !='' ">and use_status ='1'</if>  
			<if test="sort != null and sort !='' "> and sort ='2'</if>) a
		)

	</select>



</mapper>